<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—œè¥¿è·¨å¹´è±ªè¯è¡Œç¨‹ (æ—¥ç³»æ¥µç°¡é¢¨ - å¼·åŒ–éŒ¯èª¤è™•ç†)</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* å®šç¾©æ—¥ç³»æ¥µç°¡é¢¨æ ¼çš„é¡è‰²å’Œå­—é«” */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #F8F8F4; /* æ·ºç±³ç™½è‰²/ç´™ç™½è‰²èƒŒæ™¯ */
        }
        /* å®šç¾© Tailwind è‡ªå®šç¾©é¡è‰² */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'soft-green': '#E6F0E6', /* æ·ºç¶ è‰² */
                        'sepia-brown': '#6B4630', /* æ£•è‰² */
                        'header-bg': '#E0E7D6',  /* é é¦–æŸ”å’Œç¶  */
                        'primary-text': '#333333',
                    }
                }
            }
        }

        /* é é¦–åœ“å¼§æ•ˆæœ */
        #app-header {
            position: relative;
            background-color: #E0E7D6; /* é é¦–èƒŒæ™¯è‰² */
            height: 16rem; /* å¢åŠ é«˜åº¦ä»¥å®¹ç´ä½¿ç”¨è€… ID */
            overflow: hidden;
        }
        #app-header::after {
            content: '';
            position: absolute;
            bottom: -50px;
            left: 0;
            right: 0;
            height: 100px;
            background-color: #F8F8F4; /* å¿…é ˆèˆ‡ body èƒŒæ™¯è‰²ç›¸åŒ */
            border-top-left-radius: 50%;
            border-top-right-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }

        /* ä¸»å…§å®¹å€åŸŸå‘ä¸Šé‡ç–Šï¼Œä¸¦å¢åŠ åº•éƒ¨ padding ä»¥å®¹ç´å›ºå®šå°è¦½åˆ— */
        #main-content {
            position: relative;
            z-index: 10;
            margin-top: -3rem; /* å‘ä¸Šæ‹‰å‹•ä»¥é‡ç–Šåœ“å¼§ */
            padding-bottom: 7rem; /* æ–°å¢: åº•éƒ¨é‚Šè·ï¼Œé¿å…å…§å®¹è¢«å›ºå®šå°è¦½åˆ—é®æ“‹ */
        }

        /* éš±è—æ»¾å‹•æ¢ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen">
    <!-- æ‡‰ç”¨ç¨‹å¼é é¦– (Header) - åœ“å¼§éŠœæ¥ -->
    <header id="app-header" class="text-center pt-12">
        <h1 class="text-3xl font-bold text-sepia-brown">
            é—œè¥¿è·¨å¹´è¡Œç¨‹
        </h1>
        <p class="mt-1 text-lg text-primary-text/80">
            2025.12.27 ~ 2026.01.02
        </p>

        <!-- Firebase é€£ç·šç‹€æ…‹èˆ‡ä½¿ç”¨è€… ID -->
        <div class="mt-4 p-3 mx-auto max-w-sm bg-sepia-brown/10 rounded-xl">
            <p v-if="!isAuthReady" class="text-xs text-sepia-brown font-semibold">
                é€£ç·šä¸­... ğŸŒ
            </p>
            <div v-else class="text-xs text-sepia-brown text-left">
                <!-- æ ¹æ“š isTemporaryId åˆ¤æ–·é€£ç·šç‹€æ…‹ -->
                <p v-if="!isTemporaryId" class="font-semibold">
                    âœ… <span class="text-green-700">å³æ™‚åŒæ­¥å·²å•Ÿç”¨ (å·²èªè­‰)</span>
                </p>
                <p v-else-if="firebaseInitialized" class="font-semibold text-orange-700">
                    âš ï¸ <span class="text-orange-700">éèªè­‰æ¨¡å¼ (Auth éŒ¯èª¤)</span>
                </p>
                <p v-else class="font-semibold text-red-700">
                    âŒ <span class="text-red-700">é€£ç·šå¤±æ•— (é…ç½®æˆ–åˆå§‹åŒ–éŒ¯èª¤)</span>
                </p>
                <p class="mt-1 break-all">
                    æ‚¨çš„å”ä½œ ID: <span class="font-mono text-primary-text/80">{{ userId || 'N/A' }}</span>
                </p>
            </div>
        </div>
        
        <!-- Tab Icon Bar å·²ç§»è‡³æœ€ä¸‹æ–¹ -->
    </header>

    <!-- ä¸»å…§å®¹å€å¡Š - å‘ä¸Šé‡ç–Šé é¦–åœ“å¼§ -->
    <main id="main-content" class="max-w-xl mx-auto px-4">
        
        <!-- -------------------- æ¯æ—¥è¡Œç¨‹è¡¨ (Itinerary) Tab -------------------- -->
        <div v-show="currentTab === 'itinerary'" class="space-y-4">
            
            <!-- æ—¥æœŸæ©«å‘æ»‘å‹•é¸å–® -->
            <div class="overflow-x-scroll hide-scrollbar whitespace-nowrap py-3 sticky top-0 z-30 bg-F8F8F4">
                <div class="inline-flex space-x-3">
                    <div v-for="day in itineraryDays" :key="day.id" 
                         @click="selectDay(day.id)"
                         class="cursor-pointer p-2 rounded-xl text-center transition duration-200"
                         :class="currentDayId === day.id ? 'bg-sepia-brown text-white shadow-md' : 'bg-white text-primary-text border border-soft-green hover:bg-soft-green'"
                    >
                        <span class="font-bold text-sm block">{{ getDayOfWeek(day.date) }}</span>
                        <span class="font-extrabold text-xl leading-none block mt-1">{{ getDayOfMonth(day.date) }}</span>
                    </div>
                </div>
            </div>

            <!-- ç•¶æ—¥è¡Œç¨‹å…§å®¹ -->
            <div v-if="currentDay">
                <!-- å¤©æ°£è³‡è¨Š (æ¨¡æ“¬) -->
                <div class="bg-white p-4 rounded-xl shadow-lg border border-soft-green mb-4 flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <span class="text-3xl" v-html="currentDay.weather.icon"></span>
                        <div>
                            <p class="font-bold text-xl text-primary-text">{{ currentDay.weather.temp }}Â°C</p>
                            <p class="text-xs text-gray-500">é«”æ„Ÿ {{ currentDay.weather.feelsLike }}Â°C</p>
                        </div>
                    </div>
                    <p class="text-sm text-sepia-brown font-semibold">{{ currentDay.weather.location }}</p>
                </div>

                <!-- åˆ†é¡ç¯©é¸æ¬„ (Dropdown) -->
                <div class="mb-4 flex space-x-2">
                    <select v-model="filterCategory" class="p-2 border border-soft-green rounded-lg bg-white text-sm text-primary-text focus:border-sepia-brown focus:ring-sepia-brown transition">
                        <option value="">æ‰€æœ‰åˆ†é¡</option>
                        <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                    </select>
                </div>

                <!-- è¡Œç¨‹åˆ—è¡¨ -->
                <div v-for="(item, index) in filteredItems" :key="item.id" class="mb-4">
                    
                    <!-- äº¤é€šæ™‚é–“é¡¯ç¤º (éç¬¬ä¸€å€‹è¡Œç¨‹) -->
                    <div v-if="index > 0 || currentDayId > 1 && index === 0" class="flex items-center justify-center space-x-2 text-sm text-gray-500 my-2">
                         <span v-html="index === 0 ? 'ğŸ ' : item.travelModeIcon"></span>
                        <span class="text-sepia-brown font-semibold">{{ index === 0 ? 'å‰æ—¥ä½å®¿è‡³æ­¤' : item.travelTime }}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-soft-green"><line x1="12" y1="5" x2="12" y2="19"/></svg>
                    </div>
                    
                    <!-- è¡Œç¨‹å¡ç‰‡ -->
                    <div class="day-card bg-white p-4 rounded-xl shadow-md border-l-4 border-sepia-brown/50 transition-all duration-300 hover:shadow-lg">
                        
                        <!-- å¡ç‰‡é ‚éƒ¨: æ™‚é–“, åç¨±, åœ°åœ–ICON, ç·¨è¼¯ICON -->
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-grow">
                                <span class="font-bold text-base block text-sepia-brown">{{ item.time }}</span>
                                <span class="text-lg font-semibold block mt-0.5" :class="item.category === 'èˆªç­' ? 'text-red-600' : 'text-primary-text'">{{ item.name }}</span>
                            </div>

                            <div class="flex space-x-2">
                                <!-- Google Maps æŒ‰éˆ• -->
                                <a 
                                    v-if="item.mapQuery"
                                    :href="getMapLink(item.mapQuery)"
                                    target="_blank"
                                    class="p-1 rounded-full bg-sepia-brown/10 text-sepia-brown hover:bg-sepia-brown hover:text-white transition duration-150"
                                    title="Google åœ°åœ–"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 12H7"/></svg>
                                </a>
                                <!-- ç·¨è¼¯æŒ‰éˆ• -->
                                <button @click="openEditModal(item, index)" class="p-1 rounded-full bg-sepia-brown/10 text-sepia-brown hover:bg-sepia-brown hover:text-white transition duration-150" title="ç·¨è¼¯è¡Œç¨‹">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5L2 22l1.5-5.5L17 3z"/></svg>
                                </button>
                            </div>
                        </div>

                        <!-- èˆªç­å°ˆå±¬å‘ˆç¾ -->
                        <div v-if="item.category === 'èˆªç­'" class="bg-red-50 p-3 rounded-lg text-sm border-l-4 border-red-400 mt-2">
                            <p class="font-medium text-red-700">âœˆï¸ {{ item.note }}</p>
                            <p class="text-xs text-red-600">ç­æ¬¡: {{ item.transport }}</p>
                        </div>
                        
                        <!-- ä¸€èˆ¬è¡Œç¨‹è³‡è¨Š -->
                        <div v-else class="text-sm space-y-1 mt-2">
                            <p v-if="item.category === 'æ™¯é»' && item.ticketPrice" class="text-gray-600">é–€ç¥¨: <span class="font-medium text-sepia-brown">{{ item.ticketPrice }} JPY</span></p>
                            <p class="text-gray-600"><span class="font-medium text-primary-text">åˆ†é¡: {{ item.category }}</span></p>
                            <p class="text-xs text-primary-text/70">{{ item.note }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ–°å¢è¡Œç¨‹æŒ‰éˆ• (æµ®å‹•çš„ "+" æŒ‰éˆ•) -->
            <button @click="openAddModal" class="fixed bottom-20 right-6 p-4 rounded-full bg-sepia-brown text-white shadow-2xl transition hover:bg-sepia-brown/80 z-40" title="æ–°å¢è¡Œç¨‹">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>

        </div>

        <!-- -------------------- åŒ¯ç‡æ›ç®— (Exchange) Tab -------------------- -->
        <div v-show="currentTab === 'exchange'" class="p-6 bg-white rounded-2xl shadow-xl">
            <h2 class="text-xl font-bold text-sepia-brown mb-4">ğŸ’µ åŒ¯ç‡æ›ç®— (JPY $\rightarrow$ HKD)</h2>
            <div class="text-xs text-red-500 mb-4">* ä½¿ç”¨å›ºå®šæ¨¡æ“¬åŒ¯ç‡: 1 JPY = 0.052 HKD</div>
            
            <div class="space-y-4">
                <div class="flex items-center border-b pb-4">
                    <label for="jpy-input" class="text-lg font-medium w-24">æ—¥åœ“ (JPY):</label>
                    <input type="number" v-model.number="jpyAmount" @input="calculateExchange" id="jpy-input" class="flex-grow p-3 border border-soft-green rounded-lg focus:border-sepia-brown text-lg text-right" placeholder="è¼¸å…¥é‡‘é¡">
                </div>

                <div class="text-center text-sepia-brown font-extrabold text-3xl py-4">
                    =
                </div>
                
                <div class="flex items-center border-t pt-4">
                    <label for="hkd-output" class="text-lg font-medium w-24">æ¸¯å¹£ (HKD):</label>
                    <input type="text" :value="hkdAmount.toFixed(2)" id="hkd-output" readonly class="flex-grow p-3 border border-soft-green rounded-lg bg-soft-green text-lg text-right font-bold">
                </div>
            </div>
        </div>
    </main>

    <!-- -------------------- å›ºå®šåº•éƒ¨çš„ Tab Icon Bar -------------------- -->
    <div class="fixed inset-x-0 bottom-0 flex justify-center p-4 z-50">
        <div class="flex bg-white rounded-full shadow-2xl p-3 space-x-6 border border-sepia-brown/10">
            <!-- Tab: è¡Œç¨‹è¡¨ -->
            <button @click="currentTab = 'itinerary'" :class="tabClass('itinerary')" title="æ¯æ—¥è¡Œç¨‹è¡¨">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M10 15h4M10 19h4"/></svg>
            </button>
            <!-- Tab: åŒ¯ç‡æ›ç®— -->
            <button @click="currentTab = 'exchange'" :class="tabClass('exchange')" title="åŒ¯ç‡æ›ç®—">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M12 10V18"/><path d="M8 14h8"/></svg>
            </button>
        </div>
    </div>
    <!-- -------------------- End Tab Icon Bar -------------------- -->

    <!-- åº•éƒ¨ç‰ˆæ¬Š/æç¤ºè³‡è¨Š -->
    <footer class="text-center py-6 text-xs text-primary-text/50">
        <p>è¡Œç¨‹ç”± AI åŠ©æ‰‹ç”Ÿæˆã€‚è³‡æ–™ç”± Firebase Firestore é›²ç«¯å„²å­˜èˆ‡å³æ™‚åŒæ­¥ã€‚</p>
    </footer>

    <!-- -------------------- Modal å€å¡Š -------------------- -->

    <!-- è¡Œç¨‹æ–°å¢/ç·¨è¼¯å½ˆå‡ºè¦–çª— -->
    <div v-if="isItineraryModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-2xl w-full max-w-md shadow-2xl space-y-4">
            <h3 class="text-xl font-bold text-sepia-brown">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
            <form @submit.prevent="saveItineraryItem" class="space-y-3">
                
                <input type="text" v-model="form.name" placeholder="åç¨± (å¿…å¡«)" required class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown">
                <input type="text" v-model="form.time" placeholder="æ™‚é–“ (ä¾‹å¦‚: 14:00 - 17:00)" required class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown">
                
                <select v-model="form.category" class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown">
                    <option disabled value="">è«‹é¸æ“‡åˆ†é¡ (å¿…å¡«)</option>
                    <option v-for="cat in categories" :key="cat" :value="cat">{{ cat }}</option>
                </select>

                <div v-if="form.category === 'æ™¯é»'">
                    <input type="number" v-model.number="form.ticketPrice" placeholder="é–€ç¥¨åƒ¹æ ¼ (JPY)" class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown">
                </div>
                
                <textarea v-model="form.note" placeholder="ç‰¹è‰² & å‚™è¨» (ä¾‹å¦‚: æå‰é ç´„)" class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown"></textarea>
                
                <input type="text" v-model="form.mapQuery" placeholder="Google åœ°åœ–é—œéµå­— (ç”¨æ–¼å°èˆª)" class="w-full p-3 border border-soft-green rounded-lg focus:border-sepia-brown">
                
                <div class="flex space-x-3 pt-2">
                    <button type="button" @click="isItineraryModalOpen = false" class="flex-grow p-3 rounded-xl border border-gray-300 text-primary-text hover:bg-gray-100 transition">å–æ¶ˆ</button>
                    <button type="submit" class="flex-grow p-3 rounded-xl bg-sepia-brown text-white hover:bg-sepia-brown/80 transition">{{ isEditing ? 'å„²å­˜è®Šæ›´' : 'æ–°å¢' }}</button>
                </div>
                
                <button v-if="isEditing" type="button" @click="openConfirmDelete" class="w-full p-3 rounded-xl bg-red-500 text-white hover:bg-red-600 transition mt-2">åˆªé™¤è¡Œç¨‹</button>

            </form>
        </div>
    </div>
    
    <!-- è‡ªå®šç¾©ç¢ºèª/åˆªé™¤å½ˆå‡ºè¦–çª— (å–ä»£ window.confirm) -->
    <div v-if="isConfirmModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl space-y-4 text-center">
            <h3 class="text-xl font-bold text-sepia-brown">ç¢ºèªæ“ä½œ</h3>
            <p class="text-primary-text">{{ confirmMessage }}</p>
            <div class="flex space-x-3 pt-2">
                <button @click="closeConfirmModal" class="flex-grow p-3 rounded-xl border border-gray-300 text-primary-text hover:bg-gray-100 transition">å–æ¶ˆ</button>
                <button @click="executeConfirmAction" class="flex-grow p-3 rounded-xl bg-red-500 text-white hover:bg-red-600 transition">ç¢ºå®š</button>
            </div>
        </div>
    </div>


</div>

<script type="module">
    // å¼•å…¥ Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const { createApp, ref, computed, onMounted } = Vue;

    // è¼”åŠ©å‡½æ•¸ï¼šç”Ÿæˆ UUID
    function generateUUID() {
        // ä½¿ç”¨ crypto.randomUUID() è€Œé Math.random() ç¢ºä¿å”¯ä¸€æ€§
        return crypto.randomUUID();
    }

    createApp({
        setup() {
            // ----------------------------------------------------
            // ğŸ”¥ğŸ”¥ğŸ”¥  Canvas ç’°å¢ƒè®Šæ•¸è™•ç†  ğŸ”¥ğŸ”¥ğŸ”¥
            // ----------------------------------------------------
            // å–å¾—ç’°å¢ƒæä¾›çš„ Firebase é…ç½®å’Œ Auth Token
            const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
            const firebaseConfig = JSON.parse(firebaseConfigString);
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; // æ‡‰ç”¨ç¨‹å¼ ID

            let db = null;
            let auth = null;
            const userId = ref(null);
            const isAuthReady = ref(false);
            const isTemporaryId = ref(false); 
            const firebaseInitialized = ref(false); // æ–°å¢ç‹€æ…‹ï¼šè¿½è¹¤ Firebase æ˜¯å¦æˆåŠŸåˆå§‹åŒ–

            // -------------------- æ•¸æ“šç‹€æ…‹ --------------------
            const currentTab = ref('itinerary');
            const currentDayId = ref(1);
            const categories = ['æ™¯é»', 'ä½å®¿', 'ç¾é£Ÿ', 'è³¼ç‰©', 'èˆªç­', 'å…¶ä»–'];

            // Modal ç‹€æ…‹
            const isItineraryModalOpen = ref(false);
            const isEditing = ref(false);
            const editingIndex = ref(null);

            // è‡ªå®šç¾©ç¢ºèª Modal ç‹€æ…‹
            const isConfirmModalOpen = ref(false);
            const confirmMessage = ref('');
            const confirmAction = ref(null); 

            // è¡¨å–®æ•¸æ“š
            const form = ref({});

            // æ•¸æ“šå„²å­˜ç‹€æ…‹ (å¾ Firestore è¼‰å…¥)
            const itinerary = ref({ days: [] }); 

            // åŒ¯ç‡æ›ç®—ç‹€æ…‹
            const JPY_TO_HKD_RATE = 0.052; // æ¨¡æ“¬åŒ¯ç‡
            const jpyAmount = ref(10000);
            const hkdAmount = ref(jpyAmount.value * JPY_TO_HKD_RATE);

            // -------------------- å¯¦æ™‚è¨ˆç®—å±¬æ€§ --------------------
            const itineraryDays = computed(() => itinerary.value.days || []);

            const currentDay = computed(() => {
                return itineraryDays.value.find(day => day.id === currentDayId.value);
            });

            const filterCategory = ref('');
            const filteredItems = computed(() => {
                let items = currentDay.value ? currentDay.value.items : [];
                if (filterCategory.value) {
                    items = items.filter(item => item.category === filterCategory.value);
                }
                return items;
            });
            
            // -------------------- Firebase æ ¸å¿ƒåŠŸèƒ½ --------------------
            
            // å–å¾— Firestore Document Reference (å…¬å…±è³‡æ–™è·¯å¾‘)
            const getItineraryDocRef = () => {
                // å…¬å…±å”ä½œè·¯å¾‘: /artifacts/{appId}/public/data/itineraries/main-trip
                return doc(db, `artifacts/${appId}/public/data/itineraries`, 'main-trip');
            };

            // å„²å­˜/æ›´æ–°è¡Œç¨‹ (å°‡æ•´å€‹è¡Œç¨‹ç‰©ä»¶å¯«å…¥å–®ä¸€æ–‡ä»¶)
            const saveItineraryData = async () => {
                if (!db || !userId.value) return;
                
                // åªæœ‰åœ¨ Firebase æˆåŠŸåˆå§‹åŒ–ä¸”ä¸æ˜¯è‡¨æ™‚ ID æ™‚æ‰å˜—è©¦å¯«å…¥
                if (!firebaseInitialized.value || isTemporaryId.value) {
                    console.warn("ç•¶å‰è™•æ–¼éé›²ç«¯åŒæ­¥æ¨¡å¼ (è‡¨æ™‚ ID æˆ–åˆå§‹åŒ–å¤±æ•—)ï¼Œå·²é˜»æ­¢å¯«å…¥ Firestoreã€‚");
                    return;
                }

                try {
                    await setDoc(getItineraryDocRef(), itinerary.value, { merge: true });
                    console.log("è¡Œç¨‹è³‡æ–™å·²æˆåŠŸåŒæ­¥åˆ° Firestore!");
                } catch (e) {
                    console.error("åŒæ­¥è¡Œç¨‹è³‡æ–™åˆ° Firestore å¤±æ•—: ", e);
                }
            };

            // è¨­ç½®å³æ™‚ç›£è½å™¨
            const setupRealtimeListeners = (uid) => {
                if (!db || !uid) return;
                
                const docRef = getItineraryDocRef();
                
                // Firestore ç›£è½å™¨
                onSnapshot(docRef, (docSnapshot) => {
                    if (docSnapshot.exists()) {
                        const data = docSnapshot.data();
                        itinerary.value = data;
                        
                        // ç¢ºä¿è³‡æ–™çµæ§‹å®Œæ•´
                        if (!itinerary.value.days || itinerary.value.days.length === 0) {
                            itinerary.value.days = initializeItineraryData();
                            if (!isTemporaryId.value) saveItineraryData(); // æˆåŠŸç™»å…¥å¾Œæ‰å¯«å…¥åˆå§‹åŒ–è³‡æ–™
                        }
                    } else {
                        // æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯«å…¥åˆå§‹åŒ–è³‡æ–™
                        itinerary.value.days = initializeItineraryData();
                        if (!isTemporaryId.value) saveItineraryData();
                    }
                }, (error) => {
                    console.error("ç›£è½è¡Œç¨‹è³‡æ–™å¤±æ•— (å¯èƒ½æ˜¯æ¬Šé™ä¸è¶³): ", error);
                });
            };

            // -------------------- å¼·åŒ–åˆå§‹åŒ–èˆ‡èªè­‰é‚è¼¯ --------------------
            const initFirebaseAndAuth = async () => {
                // è¨­ç½® Debug ç´šåˆ¥çš„æ—¥èªŒï¼Œæœ‰åŠ©æ–¼è¨ºæ–·é€£ç·šå¤±æ•—åŸå› 
                setLogLevel('Debug');
                isAuthReady.value = false;
                userId.value = null;
                firebaseInitialized.value = false;

                let currentUid = null;
                isTemporaryId.value = false;

                try {
                    // 1. å˜—è©¦åˆå§‹åŒ– Firebase æ‡‰ç”¨ç¨‹å¼
                    if (!firebaseConfig.apiKey) {
                        throw new Error("é…ç½®éŒ¯èª¤: __firebase_config éºå¤±æˆ–ç„¡æ•ˆçš„ apiKeyã€‚");
                    }

                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app); 
                    firebaseInitialized.value = true; // æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–æˆåŠŸ

                    // 2. å˜—è©¦èªè­‰
                    try {
                        if (initialAuthToken) {
                            // å„ªå…ˆä½¿ç”¨è‡ªè¨‚ä»¤ç‰Œç™»å…¥ (Canvas ç’°å¢ƒçš„æœ€ä½³å¯¦è¸)
                            await signInWithCustomToken(auth, initialAuthToken);
                            console.log("èªè­‰æˆåŠŸ: ä½¿ç”¨è‡ªè¨‚ä»¤ç‰Œç™»å…¥ã€‚");
                        } else {
                            // ä»¤ç‰Œä¸å­˜åœ¨æ™‚ï¼Œé€€å›åˆ°åŒ¿åç™»å…¥
                            await signInAnonymously(auth);
                            console.log("èªè­‰æˆåŠŸ: åŒ¿åç™»å…¥ã€‚");
                        }
                        
                        currentUid = auth.currentUser.uid;
                        isTemporaryId.value = false; // å·²æˆåŠŸèªè­‰

                    } catch (authError) {
                        // èªè­‰å¤±æ•— (å¸¸è¦‹æ–¼åŒ¿åç™»å…¥è¢«å®‰å…¨è¦å‰‡é˜»æ“‹)
                        console.error("Firebase Auth èªè­‰å¤±æ•— (é€²å…¥éèªè­‰æ¨¡å¼):", authError);
                        
                        // å„ªé›…é™ç´šè™•ç†ï¼šç”Ÿæˆä¸€å€‹è‡¨æ™‚ ID
                        currentUid = generateUUID(); 
                        isTemporaryId.value = true;
                    }

                    // 3. è¨­ç½® ID å’Œç›£è½å™¨
                    userId.value = currentUid; 
                    setupRealtimeListeners(currentUid); // è¨­ç½®ç›£è½å™¨ (å³ä½¿æ˜¯è‡¨æ™‚ ID ä¹Ÿå˜—è©¦åªè®€è¨ªå•)

                } catch (initError) {
                    // æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•— (é…ç½®å•é¡Œ)
                    console.error("Firebase App åˆå§‹åŒ–å¤±æ•—:", initError);
                    
                    // æœ€å·®æƒ…æ³è™•ç†ï¼šç¢ºä¿ UI ä¸é¡¯ç¤º N/A
                    userId.value = generateUUID(); 
                    isTemporaryId.value = true;
                    firebaseInitialized.value = false; 
                } finally {
                    isAuthReady.value = true; // ç„¡è«–æˆåŠŸæˆ–å¤±æ•—ï¼Œéƒ½æ¨™è¨˜ç‚ºå·²å®Œæˆåˆå§‹åŒ–æµç¨‹
                }
            };

            // -------------------- æ–¹æ³• --------------------

            // æ¨£å¼è¼”åŠ©æ–¹æ³•
            const tabClass = (tabName) => {
                const base = 'p-2 rounded-full transition duration-200';
                return currentTab.value === tabName
                    ? `${base} bg-soft-green text-sepia-brown`
                    : `${base} text-primary-text/60 hover:text-sepia-brown`;
            };

            // æ—¥æœŸè¼”åŠ©æ–¹æ³•
            const getDayOfWeek = (date) => new Date(date).toLocaleDateString('zh-TW', { weekday: 'short' });
            const getDayOfMonth = (date) => new Date(date).getDate();

            const selectDay = (dayId) => {
                currentDayId.value = dayId;
                filterCategory.value = ''; // åˆ‡æ›æ—¥æœŸæ™‚é‡ç½®åˆ†é¡
            };

            const getMapLink = (query) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;

            const calculateExchange = () => {
                hkdAmount.value = jpyAmount.value * JPY_TO_HKD_RATE;
            };

            // -------------------- è‡ªå®šç¾©ç¢ºèª Modal é‚è¼¯ (å–ä»£ window.confirm) --------------------
            const openConfirmModal = (message, action) => {
                confirmMessage.value = message;
                confirmAction.value = action;
                isConfirmModalOpen.value = true;
            };

            const closeConfirmModal = () => {
                isConfirmModalOpen.value = false;
                confirmAction.value = null;
            };

            const executeConfirmAction = () => {
                if (confirmAction.value) {
                    confirmAction.value();
                }
                closeConfirmModal();
            };
            
            const openConfirmDelete = () => {
                openConfirmModal('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚', deleteItineraryItem);
            };

            // -------------------- è¡Œç¨‹ CRUD --------------------
            const openAddModal = () => {
                form.value = { id: generateUUID(), name: '', time: '', category: categories[0], note: '', mapQuery: '', ticketPrice: null, travelTime: '30åˆ†é˜', travelModeIcon: 'ğŸš¶' };
                isEditing.value = false;
                isItineraryModalOpen.value = true;
            };

            const openEditModal = (item, index) => {
                form.value = { ...item }; // è¤‡è£½ç•¶å‰é …ç›®
                editingIndex.value = index;
                isEditing.value = true;
                isItineraryModalOpen.value = true;
            };

            const saveItineraryItem = () => {
                if (!currentDay.value) return;
                
                // éèªè­‰æ¨¡å¼ä¸‹é˜»æ­¢é›²ç«¯å„²å­˜ï¼Œä½†ä»æ›´æ–°æœ¬åœ°ç‹€æ…‹
                if (isTemporaryId.value || !firebaseInitialized.value) {
                    console.warn("ç•¶å‰è™•æ–¼éé›²ç«¯åŒæ­¥æ¨¡å¼ï¼Œæ–°å¢/ç·¨è¼¯æ“ä½œåƒ…é©ç”¨æ–¼æœ¬åœ°ã€‚");
                }

                if (form.value.category === 'æ™¯é»' && !form.value.ticketPrice) form.value.ticketPrice = 0;
                
                // æ¨¡æ“¬äº¤é€šè³‡è¨Š (éå¯¦æ™‚è¨ˆç®—)
                if (!form.value.travelTime || form.value.travelTime === '0åˆ†é˜') {
                    form.value.travelTime = 'ç´„ 30 åˆ†é˜';
                    form.value.travelModeIcon = form.value.category === 'ä½å®¿' ? 'ğŸšŒ' : 'ğŸš¶';
                }

                if (isEditing.value) {
                    // æ›´æ–°ç¾æœ‰é …ç›®
                    currentDay.value.items[editingIndex.value] = form.value;
                } else {
                    // æ–°å¢é …ç›®
                    currentDay.value.items.push(form.value);
                    // ç¢ºä¿æ’åºå¾Œå†å„²å­˜
                    currentDay.value.items.sort((a, b) => a.time.localeCompare(b.time));
                }

                saveItineraryData(); // å˜—è©¦å„²å­˜åˆ° Firestore (åªæœ‰åœ¨æˆåŠŸèªè­‰å¾Œæ‰æœƒå¯«å…¥)
                isItineraryModalOpen.value = false;
            };

            const deleteItineraryItem = () => {
                if (currentDay.value && editingIndex.value !== null) {
                    if (isTemporaryId.value || !firebaseInitialized.value) {
                        console.warn("ç•¶å‰è™•æ–¼éé›²ç«¯åŒæ­¥æ¨¡å¼ï¼Œåˆªé™¤æ“ä½œåƒ…é©ç”¨æ–¼æœ¬åœ°ã€‚");
                    }
                    currentDay.value.items.splice(editingIndex.value, 1);
                    saveItineraryData(); // å˜—è©¦å„²å­˜åˆ° Firestore
                    isItineraryModalOpen.value = false;
                }
            };
            
            // -------------------- åˆå§‹æ•¸æ“š --------------------
            const initializeItineraryData = () => {
                // åˆå§‹åŒ–åŸå§‹è¡Œç¨‹æ•¸æ“šï¼Œå·²åŒ…å«æ¨¡æ“¬äº¤é€šã€åˆ†é¡å’Œå¤©æ°£
                return [
                    { id: 1, date: '2025-12-27', title: 'æŠµé”èˆ‡å§¬è·¯éŠ', weather: { icon: 'â˜€ï¸', temp: 10, feelsLike: 8, location: 'å§¬è·¯' }, items: [
                        { id: generateUUID(), time: '01:45 - 06:10', name: 'é¦™æ¸¯ HKG â†’ KIX (MM 68)', category: 'èˆªç­', note: 'é ˜å–è¡Œæ', mapQuery: 'é—œè¥¿åœ‹éš›æ©Ÿå ´ KIX', travelTime: '0åˆ†é˜', travelModeIcon: 'âœˆï¸', transport: 'MM 68' },
                        { id: generateUUID(), time: '08:50 - 11:10', name: 'KIX â†’ å§¬è·¯ç«™', category: 'äº¤é€š', note: 'KIX T1 6 è™Ÿä¹˜è»Šè™•', mapQuery: 'å§¬è·¯ç«™', travelTime: '150åˆ†é˜', travelModeIcon: 'ğŸšŒ' },
                        { id: generateUUID(), time: '11:10 - 12:00', name: 'Richmond Hotel Himeji', category: 'ä½å®¿', note: 'è¾¦ç†å…¥ä½/å¯„æ”¾è¡Œæ', mapQuery: 'Richmond Hotel Himeji', travelTime: '15åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '14:00 - 17:00', name: 'æ›¸å¯«å±±åœ“æ•™å¯º éŠè¦½', category: 'æ™¯é»', note: 'é ç•™ 3 å°æ™‚', mapQuery: 'æ›¸å¯«å±±åœ“æ•™å¯º', ticketPrice: 500, travelTime: '60åˆ†é˜', travelModeIcon: 'ğŸšŒ' },
                        { id: generateUUID(), time: '19:30 onwards', name: 'æ™šé¤', category: 'ç¾é£Ÿ', note: 'å¯åœ¨å§¬è·¯ç«™å‘¨é‚Šå°‹æ‰¾', mapQuery: 'å§¬è·¯ç«™ ç¾é£Ÿ', travelTime: '15åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                    ]},
                    { id: 2, date: '2025-12-28', title: 'å§¬è·¯æ·±åº¦éŠ', weather: { icon: 'ğŸŒ¤ï¸', temp: 12, feelsLike: 10, location: 'å§¬è·¯' }, items: [
                        { id: generateUUID(), time: '09:00 - 12:00', name: 'å§¬è·¯åŸ', category: 'æ™¯é»', note: 'ä¸–ç•Œæ–‡åŒ–éºç”¢ï¼Œå»ºè­°é–‹åœ’æ™‚å…¥å ´', mapQuery: 'å§¬è·¯åŸ', ticketPrice: 1000, travelTime: '10åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '13:30 - 16:00', name: 'å¥½å¤åœ’', category: 'æ™¯é»', note: 'æ—¥å¼åº­åœ’ï¼Œå»ºè­°è³¼è²·è¯ç¥¨', mapQuery: 'å¥½å¤åœ’', ticketPrice: 300, travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '18:30 onwards', name: 'æ™šé¤', category: 'ç¾é£Ÿ', note: 'çºŒä½ Richmond Hotel Himeji', mapQuery: 'å§¬è·¯ ç¾é£Ÿæ¨è–¦', travelTime: '15åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                    ]},
                    { id: 3, date: '2025-12-29', title: 'ç¥æˆ¶è³¼ç‰©èˆ‡å¨›æ¨‚æ—¥', weather: { icon: 'â˜ï¸', temp: 14, feelsLike: 12, location: 'ç¥æˆ¶' }, items: [
                        { id: generateUUID(), time: '09:30 - 10:35', name: 'å§¬è·¯ $\rightarrow$ ç¥æˆ¶ä¸‰å®®', category: 'äº¤é€š', note: 'å±±é™½ç›´é€šç‰¹æ€¥', mapQuery: 'ç¥æˆ¶ä¸‰å®®ç«™', travelTime: '70åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '10:35 - 11:00', name: 'BRENZA HOTEL', category: 'ä½å®¿', note: 'å¯„æ”¾è¡Œæ', mapQuery: 'BRENZA HOTEL', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '12:30 - 14:00', name: 'Steakland ç¥æˆ¶ç‰›åˆé¤', category: 'ç¾é£Ÿ', note: 'å‹™å¿…æå‰é ç´„', mapQuery: 'Steakland Kobe', travelTime: '10åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '14:00 - 19:00', name: 'è³¼ç‰©èˆ‡å¤¾å…¬ä»”', category: 'è³¼ç‰©', note: 'ä¸‰å®®ä¸­å¿ƒè¡— & GiGO/Taito Station', mapQuery: 'ç¥æˆ¶ä¸‰å®®ä¸­å¿ƒè¡—', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '19:00 - 20:30', name: 'MOSAIC å»£å ´æ™šé¤', category: 'ç¾é£Ÿ', note: 'æ¬£è³å¤œæ™¯', mapQuery: 'ç¥æˆ¶ é¦¬è³½å…‹å»£å ´', travelTime: '20åˆ†é˜', travelModeIcon: 'ğŸšŒ' },
                    ]},
                    { id: 4, date: '2025-12-30', title: 'å…­ç”²å±±èˆ‡æœ‰é¦¬æº«æ³‰', weather: { icon: 'ğŸŒ¨ï¸', temp: 5, feelsLike: 3, location: 'å…­ç”²å±±' }, items: [
                        { id: generateUUID(), time: '09:00 - 11:00', name: 'ä¸‰å®® $\rightarrow$ å…­ç”²å±±é ‚', category: 'äº¤é€š', note: 'JR $\rightarrow$ å·´å£« $\rightarrow$ çºœè»Š', mapQuery: 'å…­ç”²å±±é ‚', travelTime: '90åˆ†é˜', travelModeIcon: 'ğŸšŒ' },
                        { id: generateUUID(), time: '13:00 - 14:00', name: 'å…­ç”²å±± $\rightarrow$ æœ‰é¦¬æº«æ³‰', category: 'äº¤é€š', note: 'å…­ç”²æœ‰é¦¬çºœè»Š', mapQuery: 'æœ‰é¦¬æº«æ³‰', travelTime: '30åˆ†é˜', travelModeIcon: 'ğŸš ' },
                        { id: generateUUID(), time: '14:00 - 17:30', name: 'æœ‰é¦¬æº«æ³‰ é«”é©—', category: 'æ™¯é»', note: 'é«”é©—é‡‘/éŠ€ä¹‹æ¹¯', mapQuery: 'æœ‰é¦¬æº«æ³‰ é‡‘ä¹‹æ¹¯', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶', ticketPrice: 850 },
                        { id: generateUUID(), time: '17:30 - 19:00', name: 'è¿”å›ç¥æˆ¶ä¸‰å®®', category: 'äº¤é€š', note: 'å·´å£«æˆ–ç¥æˆ¶é›»éµ', mapQuery: 'ç¥æˆ¶ä¸‰å®®ç«™', travelTime: '60åˆ†é˜', travelModeIcon: 'ğŸšŒ' },
                    ]},
                    { id: 5, date: '2025-12-31', title: 'å¤§é˜ª USJ è·¨å¹´æ´¾å°', weather: { icon: 'ğŸ†', temp: 10, feelsLike: 9, location: 'å¤§é˜ª' }, items: [
                        { id: generateUUID(), time: '09:30 - 10:35', name: 'ç¥æˆ¶ $\rightarrow$ æ·€å±‹æ©‹', category: 'äº¤é€š', note: 'é˜ªç¥ $\rightarrow$ åœ°éµ', mapQuery: 'æ·€å±‹æ©‹äº¬é˜ªé£¯åº—', travelTime: '60åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '10:35 - 11:00', name: 'BRENZA HOTEL', category: 'ä½å®¿', note: 'å¯„æ”¾è¡Œæ', mapQuery: 'BRENZA HOTEL', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '13:00 - 14:00', name: 'æ·€å±‹æ©‹ $\rightarrow$ ç’°çƒåŸ', category: 'äº¤é€š', note: 'åœ°éµ $\rightarrow$ JR', mapQuery: 'ç’°çƒåŸç«™', travelTime: '45åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '17:00 - 00:30', name: 'USJ è·¨å¹´æ´¾å°', category: 'æ™¯é»', note: 'ç«‹å³æŠ½é¸ç‘ªåˆ©æ­å€æ•´ç†åˆ¸ï¼', mapQuery: 'æ—¥æœ¬ç’°çƒå½±åŸ', ticketPrice: 9800, travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                    ]},
                    { id: 6, date: '2026-01-01', title: 'USJ çºŒæ”¤èˆ‡ä¼‘æ•´æ—¥', weather: { icon: 'ğŸŒ¤ï¸', temp: 10, feelsLike: 8, location: 'å¤§é˜ª' }, items: [
                        { id: generateUUID(), time: '02:00 - 06:00', name: 'SNW ç‘ªåˆ©æ­å€', category: 'æ™¯é»', note: 'é»ƒé‡‘æ™‚æ®µï¼Œäººæ½®æœ€å°‘', mapQuery: 'è¶…ç´šä»»å¤©å ‚ä¸–ç•Œ', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶', ticketPrice: 0 },
                        { id: generateUUID(), time: '09:00 - 10:00', name: 'è¿”å›æ·€å±‹æ©‹é£¯åº—', category: 'äº¤é€š', note: 'JR $\rightarrow$ åœ°éµ', mapQuery: 'æ·€å±‹æ©‹äº¬é˜ªé£¯åº—', travelTime: '45åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '10:00 - 16:00', name: 'é•·è·é›¢ä¼‘æ¯èˆ‡è£œçœ ', category: 'ä½å®¿', note: 'æ¢å¾©é«”åŠ›', mapQuery: 'æ·€å±‹æ©‹äº¬é˜ªé£¯åº—', travelTime: '0åˆ†é˜', travelModeIcon: 'ğŸ›Œ' },
                        { id: generateUUID(), time: '16:00 - 18:00', name: 'ä¸­ä¹‹å³¶ è¼•é¬†æ•£æ­¥', category: 'å…¶ä»–', note: 'é£¯åº—å‘¨é‚Šæ­¥è¡Œå¯é”', mapQuery: 'ä¸­ä¹‹å³¶å…¬åœ’', travelTime: '15åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                    ]},
                    { id: 7, date: '2026-01-02', title: 'è§€å…‰èˆ‡è¿”ç¨‹æ—¥', weather: { icon: 'â˜ï¸', temp: 13, feelsLike: 11, location: 'å¤§é˜ª' }, items: [
                        { id: generateUUID(), time: '09:30 - 12:30', name: 'å¤§é˜ªæµ·éŠé¤¨åƒè§€', category: 'æ™¯é»', note: 'æ­ä¹˜åœ°éµ', mapQuery: 'å¤§é˜ªæµ·éŠé¤¨', ticketPrice: 2700, travelTime: '30åˆ†é˜', travelModeIcon: 'ğŸš‡' },
                        { id: generateUUID(), time: '13:30 - 14:30', name: 'æµ·éŠé¤¨ $\rightarrow$ è‡¨ç©ºåŸ', category: 'äº¤é€š', note: 'JR/å—æµ·é›»éµ', mapQuery: 'è‡¨ç©ºåŸ Premium Outlet', travelTime: '60åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '14:30 - 18:00', name: 'è‡¨ç©ºåŸ Outlet è³¼ç‰©', category: 'è³¼ç‰©', note: 'è¿”ç¨‹å‰æœ€å¾Œè¡€æ‹¼', mapQuery: 'è‡¨ç©ºåŸ Premium Outlet', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš¶' },
                        { id: generateUUID(), time: '18:00 - 18:30', name: 'è‡¨ç©ºåŸ $\rightarrow$ KIX', category: 'äº¤é€š', note: 'è»Šç¨‹ 5 åˆ†é˜', mapQuery: 'é—œè¥¿åœ‹éš›æ©Ÿå ´ KIX', travelTime: '5åˆ†é˜', travelModeIcon: 'ğŸš†' },
                        { id: generateUUID(), time: '21:05', name: 'KIX $\rightarrow$ é¦™æ¸¯ HKG (MM 67)', category: 'èˆªç­', note: 'é ç•™å……è¶³æ™‚é–“è¾¦ç†æ‰‹çºŒ', mapQuery: 'é—œè¥¿åœ‹éš›æ©Ÿå ´ KIX', travelTime: '0åˆ†é˜', travelModeIcon: 'âœˆï¸', transport: 'MM 67' },
                    ]}
                ];
            };

            // -------------------- åˆå§‹åŒ– --------------------
            onMounted(() => {
                // åœ¨é€™è£¡å‘¼å« initFirebaseAndAuthï¼Œå®ƒæœƒä½¿ç”¨å¾ç’°å¢ƒè®Šæ•¸ '__firebase_config' ä¸­å–å¾—çš„é…ç½®
                initFirebaseAndAuth(); 
                calculateExchange(); 
            });

            return {
                currentTab,
                currentDayId,
                categories,
                isItineraryModalOpen,
                isEditing,
                form,
                itineraryDays, 
                jpyAmount,
                hkdAmount,
                tabClass,
                getDayOfWeek,
                getDayOfMonth,
                selectDay,
                currentDay,
                filterCategory,
                filteredItems,
                getMapLink,
                calculateExchange,
                openAddModal,
                openEditModal,
                saveItineraryItem,
                openConfirmDelete, 
                // Firebase ç‹€æ…‹
                userId,
                isAuthReady,
                isTemporaryId,
                firebaseInitialized, 
                // è‡ªå®šç¾©ç¢ºèª Modal 
                isConfirmModalOpen,
                confirmMessage,
                closeConfirmModal,
                executeConfirmAction
            };
        }
    }).mount('#app');
</script>

</body>
</html>
